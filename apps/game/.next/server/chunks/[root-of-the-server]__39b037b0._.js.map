{"version":3,"sources":["../../../../../apps/game/src/lib/env.server.ts","../../../../../apps/game/src/lib/email/templates/base.ts","../../../../../apps/game/src/lib/email/templates/welcome.ts"],"sourcesContent":["/**\n * Environment Variables - Server Only\n * \n * ⚠️  THIS FILE MUST ONLY BE IMPORTED IN SERVER COMPONENTS OR API ROUTES\n * \n * Contains secret keys that must NEVER be exposed to the client.\n * Next.js will throw an error if you try to import this in a client component.\n */\n\nimport \"server-only\";\n\n// Get public env vars - read directly to avoid circular import issues\nexport const publicEnv = {\n  get NEXT_PUBLIC_SUPABASE_URL(): string {\n    const value = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    if (!value) {\n      throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL in environment\");\n    }\n    return value;\n  },\n  get NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY(): string {\n    const value = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\n    if (!value) {\n      throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY in environment\");\n    }\n    return value;\n  },\n  get NEXT_PUBLIC_APP_URL(): string {\n    return process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\";\n  },\n} as const;\n\n// Server-only env vars\nexport const serverEnv = {\n  get SUPABASE_SECRET_KEY(): string {\n    const value = process.env.SUPABASE_SECRET_KEY;\n    if (!value) {\n      throw new Error(\"Missing SUPABASE_SECRET_KEY in environment\");\n    }\n    return value;\n  },\n  get REDIS_URL(): string | null {\n    return process.env.REDIS_URL || null;\n  },\n  // Email configuration (optional - email features disabled if not set)\n  get EMAIL_HOST(): string | null {\n    return process.env.EMAIL_HOST || null;\n  },\n  get EMAIL_HOST_USER(): string | null {\n    return process.env.EMAIL_HOST_USER || null;\n  },\n  get EMAIL_HOST_PASSWORD(): string | null {\n    return process.env.EMAIL_HOST_PASSWORD || null;\n  },\n  get EMAIL_PORT(): number {\n    return parseInt(process.env.EMAIL_PORT || \"587\", 10);\n  },\n  get FROM_MAIL(): string {\n    return process.env.FROM_MAIL || \"noreply@mulearn.org\";\n  },\n  get isEmailConfigured(): boolean {\n    return !!(process.env.EMAIL_HOST && process.env.EMAIL_HOST_USER && process.env.EMAIL_HOST_PASSWORD);\n  },\n} as const;\n\n// Types\nexport type PublicEnv = typeof publicEnv;\nexport type ServerEnv = typeof serverEnv;\n","/**\n * Base Email Template Utilities\n * \n * Shared styling constants and helpers for consistent email design.\n * Modern dark blue theme inspired by premium SaaS aesthetics.\n */\n\nimport { publicEnv } from \"@/lib/env.server\";\n\n/**\n * Color palette for email templates\n * Vibrant electric blue theme inspired by modern tech aesthetics\n */\nexport const COLORS = {\n  // Backgrounds - Electric blue primary\n  bgPrimary: \"#0052FF\",\n  bgCard: \"#0041CC\",\n  bgDark: \"#001A4D\",\n  \n  // Text\n  textPrimary: \"#ffffff\",\n  textSecondary: \"rgba(255, 255, 255, 0.85)\",\n  textMuted: \"rgba(255, 255, 255, 0.6)\",\n  \n  // Accents\n  accent: \"#ffffff\",\n  accentDark: \"rgba(255, 255, 255, 0.1)\",\n  \n  // Borders\n  border: \"rgba(255, 255, 255, 0.15)\",\n  borderLight: \"rgba(255, 255, 255, 0.08)\",\n} as const;\n\n/**\n * Typography styles\n */\nexport const TYPOGRAPHY = {\n  fontFamily: \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif\",\n  heading: \"font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;\",\n  body: \"font-size: 16px; line-height: 1.6;\",\n} as const;\n\n/**\n * Escape HTML special characters to prevent XSS\n */\nexport function escapeHtml(text: string): string {\n  const htmlEscapes: Record<string, string> = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#39;\",\n  };\n  return text.replace(/[&<>\"']/g, (char) => htmlEscapes[char] || char);\n}\n\n/**\n * Generate the base HTML structure for all emails\n */\nexport function generateEmailBase(content: string, title: string): string {\n  return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <title>${escapeHtml(title)}</title>\n  <!--[if mso]>\n  <noscript>\n    <xml>\n      <o:OfficeDocumentSettings>\n        <o:PixelsPerInch>96</o:PixelsPerInch>\n      </o:OfficeDocumentSettings>\n    </xml>\n  </noscript>\n  <![endif]-->\n</head>\n<body style=\"margin: 0; padding: 0; background-color: ${COLORS.bgPrimary}; font-family: ${TYPOGRAPHY.fontFamily};\">\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: ${COLORS.bgPrimary};\">\n    <tr>\n      <td align=\"center\" style=\"padding: 40px 20px;\">\n        ${content}\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n`.trim();\n}\n\n/**\n * Generate the email footer\n */\nexport function generateFooter(message?: string): string {\n  const defaultMessage = \"You received this email from Debrief.\";\n  return `\n<table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"max-width: 520px;\">\n  <tr>\n    <td style=\"padding: 32px 20px;\">\n      <p style=\"margin: 0; color: ${COLORS.textMuted}; font-size: 12px; line-height: 1.5; text-align: center;\">\n        ${message || defaultMessage}<br>\n        <a href=\"${publicEnv.NEXT_PUBLIC_APP_URL}\" style=\"color: ${COLORS.textSecondary}; text-decoration: none;\">debrief.app</a>\n      </p>\n    </td>\n  </tr>\n</table>\n`.trim();\n}\n\n/**\n * Generate a styled CTA button\n */\nexport function generateButton(text: string, url: string): string {\n  return `\n<table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\">\n  <tr>\n    <td align=\"center\" style=\"padding: 24px 0;\">\n      <a href=\"${url}\" style=\"display: inline-block; background-color: ${COLORS.textPrimary}; color: ${COLORS.bgDark}; text-decoration: none; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; padding: 16px 40px; border-radius: 6px;\">\n        ${escapeHtml(text)}\n      </a>\n    </td>\n  </tr>\n</table>\n`.trim();\n}\n\n/**\n * Generate a styled info card\n */\nexport function generateCard(content: string): string {\n  return `\n<table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" style=\"width: 100%; background-color: ${COLORS.bgCard}; border: 1px solid ${COLORS.border}; border-radius: 12px;\">\n  <tr>\n    <td style=\"padding: 32px;\">\n      ${content}\n    </td>\n  </tr>\n</table>\n`.trim();\n}\n","/**\n * Welcome Email Template\n * \n * Modern vibrant blue email template for welcoming new users.\n * Sent after first-time signup/login.\n */\n\nimport { publicEnv } from \"@/lib/env.server\";\nimport { COLORS, escapeHtml, generateEmailBase, generateFooter } from \"./base\";\n\nexport interface WelcomeEmailData {\n  userName: string;\n  userEmail: string;\n}\n\n/**\n * Generate the HTML email content for welcome message\n */\nexport function generateWelcomeEmailHtml(data: WelcomeEmailData): string {\n  const dashboardUrl = publicEnv.NEXT_PUBLIC_APP_URL;\n  const newIdeaUrl = `${publicEnv.NEXT_PUBLIC_APP_URL}/ideas/new`;\n  const firstName = data.userName.split(' ')[0] || 'there';\n\n  const content = `\n<!-- Main Container -->\n<table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"max-width: 520px;\">\n  <tr>\n    <td style=\"padding: 20px;\">\n      <!-- Header Text -->\n      <p style=\"margin: 0 0 8px 0; color: ${COLORS.textPrimary}; font-size: 14px; font-weight: 400; line-height: 1.4;\">\n        HEY ${escapeHtml(firstName.toUpperCase())},\n      </p>\n      <p style=\"margin: 0 0 32px 0; color: ${COLORS.textPrimary}; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; line-height: 1.5;\">\n        WELCOME TO DEBRIEF — YOUR IDEAS JUST GOT A NEW HOME.\n      </p>\n\n      <!-- Welcome Card -->\n      <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" style=\"width: 100%; background-color: ${COLORS.bgCard}; border-radius: 16px; margin-bottom: 32px;\">\n        <tr>\n          <td style=\"padding: 32px;\">\n            <!-- Indicator -->\n            <p style=\"margin: 0 0 8px 0; color: ${COLORS.textMuted}; font-size: 32px; font-weight: 300; font-family: monospace;\">\n              //00\n            </p>\n            <!-- Title -->\n            <h1 style=\"margin: 0 0 16px 0; color: ${COLORS.textPrimary}; font-size: 28px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; line-height: 1.2;\">\n              THE FORGE\n            </h1>\n            <!-- Info -->\n            <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\">\n              <tr>\n                <td style=\"padding-right: 24px;\">\n                  <p style=\"margin: 0 0 4px 0; color: ${COLORS.textMuted}; font-size: 10px; font-weight: 400; text-transform: uppercase; letter-spacing: 0.1em;\">\n                    STATUS\n                  </p>\n                  <p style=\"margin: 0; color: ${COLORS.textPrimary}; font-size: 13px; font-weight: 600;\">\n                    Ready to build\n                  </p>\n                </td>\n                <td>\n                  <p style=\"margin: 0 0 4px 0; color: ${COLORS.textMuted}; font-size: 10px; font-weight: 400; text-transform: uppercase; letter-spacing: 0.1em;\">\n                    ACCESS\n                  </p>\n                  <p style=\"margin: 0; color: ${COLORS.textPrimary}; font-size: 13px; font-weight: 600;\">\n                    Full platform access\n                  </p>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Description Text -->\n      <p style=\"margin: 0 0 24px 0; color: ${COLORS.textPrimary}; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; line-height: 1.6;\">\n        DEBRIEF IS WHERE YOUR IDEAS GET VALIDATED, REFINED, AND PROVEN BEFORE YOU BUILD. THINK OF IT AS YOUR IDEA'S GYM — WE'LL HELP YOU STRESS-TEST IT.\n      </p>\n\n      <!-- What's Next -->\n      <p style=\"margin: 0 0 16px 0; color: ${COLORS.textSecondary}; font-size: 13px; line-height: 1.6;\">\n        Here's what you can do:\n      </p>\n      <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-bottom: 24px;\">\n        <tr>\n          <td style=\"padding: 8px 0;\">\n            <p style=\"margin: 0; color: ${COLORS.textPrimary}; font-size: 13px; font-weight: 600;\">\n              → Submit your first idea and get community feedback\n            </p>\n          </td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 0;\">\n            <p style=\"margin: 0; color: ${COLORS.textPrimary}; font-size: 13px; font-weight: 600;\">\n              → Level up through the forge to refine your concept\n            </p>\n          </td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 0;\">\n            <p style=\"margin: 0; color: ${COLORS.textPrimary}; font-size: 13px; font-weight: 600;\">\n              → Invite collaborators to help shape your vision\n            </p>\n          </td>\n        </tr>\n      </table>\n\n      <!-- CTA Button -->\n      <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\">\n        <tr>\n          <td style=\"padding: 8px 0 32px 0;\">\n            <a href=\"${newIdeaUrl}\" style=\"display: inline-block; background-color: ${COLORS.textPrimary}; color: ${COLORS.bgPrimary}; text-decoration: none; font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; padding: 16px 40px; border-radius: 6px;\">\n              Create Your First Idea\n            </a>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Closing -->\n      <p style=\"margin: 0 0 8px 0; color: ${COLORS.textPrimary}; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; line-height: 1.6;\">\n        LET'S MAKE SOMETHING GREAT.\n      </p>\n      <p style=\"margin: 0; color: ${COLORS.textSecondary}; font-size: 13px; line-height: 1.5;\">\n        — The Debrief Team\n      </p>\n    </td>\n  </tr>\n</table>\n\n${generateFooter(\"You received this because you signed up for Debrief.\")}\n`;\n\n  return generateEmailBase(content, \"Welcome to Debrief\");\n}\n\n/**\n * Generate plain text version of the welcome email\n */\nexport function generateWelcomeEmailText(data: WelcomeEmailData): string {\n  const newIdeaUrl = `${publicEnv.NEXT_PUBLIC_APP_URL}/ideas/new`;\n  const firstName = data.userName.split(' ')[0] || 'there';\n\n  return `\nHEY ${firstName.toUpperCase()},\n\nWELCOME TO DEBRIEF — YOUR IDEAS JUST GOT A NEW HOME.\n\nDebrief is where your ideas get validated, refined, and proven before you build. Think of it as your idea's gym — we'll help you stress-test it.\n\nHere's what you can do:\n→ Submit your first idea and get community feedback\n→ Level up through the forge to refine your concept\n→ Invite collaborators to help shape your vision\n\nCreate your first idea: ${newIdeaUrl}\n\nLET'S MAKE SOMETHING GREAT.\n\n— The Debrief Team\n\n---\nYou received this because you signed up for Debrief.\n`.trim();\n}\n"],"names":[],"mappings":"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"}