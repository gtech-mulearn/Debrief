module.exports=[18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},23502,(e,t,a)=>{},95879,e=>{"use strict";e.i(23502),e.s(["publicEnv",0,{get NEXT_PUBLIC_SUPABASE_URL(){return"https://dgejklzxhjvnehbawadb.supabase.co"},get NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY(){return"sb_publishable_lARX_z11Ly0MR_Zh_Ik4Ig_m3SVIgh0"},get NEXT_PUBLIC_APP_URL(){return"http://localhost:3000"}},"serverEnv",0,{get SUPABASE_SECRET_KEY(){let e=process.env.SUPABASE_SECRET_KEY;if(!e)throw Error("Missing SUPABASE_SECRET_KEY in environment");return e},get REDIS_URL(){return process.env.REDIS_URL||null},get EMAIL_HOST(){return process.env.EMAIL_HOST||null},get EMAIL_HOST_USER(){return process.env.EMAIL_HOST_USER||null},get EMAIL_HOST_PASSWORD(){return process.env.EMAIL_HOST_PASSWORD||null},get EMAIL_PORT(){return parseInt(process.env.EMAIL_PORT||"587",10)},get FROM_MAIL(){return process.env.FROM_MAIL||"noreply@mulearn.org"},get isEmailConfigured(){return!!(process.env.EMAIL_HOST&&process.env.EMAIL_HOST_USER&&process.env.EMAIL_HOST_PASSWORD)}}])},12298,e=>{"use strict";var t=e.i(14159);async function a(){let e=await (0,t.createServerClient)(),{data:{user:a},error:r}=await e.auth.getUser();if(r||!a)throw Error("Unauthorized: Not authenticated");let{data:n}=await e.from("app_admins").select("email").eq("email",a.email).single();if(!n)throw Error("Forbidden: Admin access required");return a}e.s(["requireAdmin",()=>a])},59457,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),s=e.i(61916),o=e.i(74677),i=e.i(69741),l=e.i(16795),c=e.i(87718),d=e.i(95169),u=e.i(47587),p=e.i(66012),f=e.i(70101),m=e.i(26937),_=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(5232),w=e.i(89171),v=e.i(14159),E=e.i(12298);async function x(e){try{let t;await (0,E.requireAdmin)();let a=await (0,v.createServerClient)(),{searchParams:r}=new URL(e.url),n=r.get("range")||"30d",s=new Date;switch(n){case"7d":t=new Date(s.getTime()-6048e5);break;case"30d":default:t=new Date(s.getTime()-2592e6);break;case"90d":t=new Date(s.getTime()-7776e6);break;case"all":t=new Date(0)}let[o,i,l,c,d]=await Promise.all([R(a,t),S(a,t),A(a),y(a,t),T(a,t)]);return w.NextResponse.json({success:!0,data:{users:o,ideas:i,games:l,timelines:{signups:c,ideas:d},range:n,generatedAt:new Date().toISOString()}})}catch(a){let e=a instanceof Error?a.message:"Unknown error",t=e.includes("Unauthorized")?401:e.includes("Forbidden")?403:500;return w.NextResponse.json({success:!1,error:e},{status:t})}}async function R(e,t){let{count:a}=await e.from("profiles").select("*",{count:"exact",head:!0}),{count:r}=await e.from("profiles").select("*",{count:"exact",head:!0}).gte("created_at",t.toISOString()),n=new Date(Date.now()-6048e5),{count:s}=await e.from("profiles").select("*",{count:"exact",head:!0}).gte("updated_at",n.toISOString());return{total:a||0,new:r||0,active:s||0}}async function S(e,t){let{count:a}=await e.from("ideas").select("*",{count:"exact",head:!0}),{count:r}=await e.from("ideas").select("*",{count:"exact",head:!0}).gte("created_at",t.toISOString()),{data:n}=await e.from("ideas").select("upvotes_count, downvotes_count"),s=0,o=0;if(n)for(let e of n)s+=e.upvotes_count||0,o+=e.downvotes_count||0;let{count:i}=await e.from("comments").select("*",{count:"exact",head:!0}),{count:l}=await e.from("idea_feedback").select("*",{count:"exact",head:!0}),{count:c}=await e.from("idea_backers").select("*",{count:"exact",head:!0}),{data:d}=await e.from("ideas").select("current_level"),u={};if(d)for(let e of d){let t=e.current_level||1;u[t]=(u[t]||0)+1}let{data:p}=await e.from("ideas").select("id, title, upvotes_count, downvotes_count").order("upvotes_count",{ascending:!1}).limit(5);return{total:a||0,new:r||0,totalUpvotes:s,totalDownvotes:o,totalComments:i||0,totalFeedback:l||0,totalBackers:c||0,byLevel:u,topVoted:p||[],avgVotesPerIdea:a?((s+o)/a).toFixed(2):"0"}}async function A(e){let{count:t}=await e.from("sim_games").select("*",{count:"exact",head:!0}),{data:a}=await e.from("sim_games").select("status"),r={waiting:0,active:0,completed:0};if(a)for(let e of a)r[e.status]=(r[e.status]||0)+1;let{count:n}=await e.from("sim_teams").select("*",{count:"exact",head:!0}),{data:s}=await e.from("sim_teams").select("total_downloads, total_spent"),o=0,i=0;if(s)for(let e of s)o+=Number(e.total_downloads)||0,i+=Number(e.total_spent)||0;let{data:l}=await e.from("sim_results").select("efficiency_score"),c=0;l&&l.length>0&&(c=l.reduce((e,t)=>e+(t.efficiency_score||0),0)/l.length);let{data:d}=await e.from("sim_decisions").select("decisions"),u={};if(d)for(let e of d)for(let[t,a]of Object.entries(e.decisions))u[t]=(u[t]||0)+Number(a);let{count:p}=await e.from("game_sessions_archive").select("*",{count:"exact",head:!0});return{total:t||0,byStatus:r,totalTeams:n||0,avgTeamsPerGame:t?(n/t).toFixed(2):"0",totalDownloads:o,totalSpent:i,avgEfficiency:c.toFixed(2),channelPopularity:u,archivedGames:p||0}}async function y(e,t){let{data:a}=await e.from("profiles").select("created_at").gte("created_at",t.toISOString()).order("created_at",{ascending:!0}),r={};if(a)for(let e of a){let t=new Date(e.created_at).toISOString().split("T")[0];r[t]=(r[t]||0)+1}return Object.entries(r).map(([e,t])=>({date:e,count:t}))}async function T(e,t){let{data:a}=await e.from("ideas").select("created_at").gte("created_at",t.toISOString()).order("created_at",{ascending:!0}),r={};if(a)for(let e of a){let t=new Date(e.created_at).toISOString().split("T")[0];r[t]=(r[t]||0)+1}return Object.entries(r).map(([e,t])=>({date:e,count:t}))}e.s(["GET",()=>x],52544);var b=e.i(52544);let O=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/game/src/app/api/admin/analytics/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:I,workUnitAsyncStorage:C,serverHooks:P}=O;function U(){return(0,r.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:C})}async function N(e,t,r){O.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/admin/analytics/route";w=w.replace(/\/index$/,"")||"/";let v=await O.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:E,params:x,nextConfig:R,parsedUrl:S,isDraftMode:A,prerenderManifest:y,routerServerContext:T,isOnDemandRevalidate:b,revalidateOnlyGenerated:I,resolvedPathname:C,clientReferenceManifest:P,serverActionsManifest:U}=v,N=(0,i.normalizeAppPath)(w),k=!!(y.dynamicRoutes[N]||y.routes[C]),L=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,S,!1):t.end("This page could not be found"),null);if(k&&!A){let e=!!y.routes[C],t=y.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await L();throw new g.NoFallbackError}}let M=null;!k||O.isDev||A||(M="/index"===(M=C)?"/":M);let D=!0===O.isDev||!k,H=k&&!D;U&&P&&(0,o.setManifestsSingleton)({page:w,clientReferenceManifest:P,serverActionsManifest:U});let j=e.method||"GET",q=(0,s.getTracer)(),B=q.getActiveScopeSpan(),F={params:x,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>O.onRequestError(e,t,r,n,T)},sharedContext:{buildId:E}},K=new l.NodeNextRequest(e),$=new l.NodeNextResponse(t),X=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let o=async e=>O.handle(X,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${j} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${w}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let c=async({previousCacheEntry:a})=>{try{if(!i&&b&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=F.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)(K,$,s,F.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[_.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:b})},!1,T),t}},d=await O.handleResponse({req:e,nextConfig:R,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:i});if(!k)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",b?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&k||g.delete(_.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(K,$,new Response(d.value.body,{headers:g,status:d.value.status||200})),null};B?await l(B):await q.withPropagatedContext(e.headers,()=>q.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${w}`,kind:s.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:b})},!1,T),k)throw t;return await (0,p.sendResponse)(K,$,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>U,"routeModule",()=>O,"serverHooks",()=>P,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>C],59457)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fff9325f._.js.map