module.exports=[3444,e=>{"use strict";let t,r,n,i;var s,o,a=e.i(47909),u=e.i(74017),l=e.i(96250),d=e.i(59756),c=e.i(61916),p=e.i(74677),f=e.i(69741),h=e.i(16795),m=e.i(87718),_=e.i(95169),v=e.i(47587),g=e.i(66012),y=e.i(70101),b=e.i(26937),w=e.i(10372),z=e.i(93695);e.i(52474);var R=e.i(5232),E=e.i(14159),x=e.i(89171);function N(e,t,r){function n(r,n){if(r._zod||Object.defineProperty(r,"_zod",{value:{def:n,constr:o,traits:new Set},enumerable:!1}),r._zod.traits.has(e))return;r._zod.traits.add(e),t(r,n);let i=o.prototype,s=Object.keys(i);for(let e=0;e<s.length;e++){let t=s[e];t in r||(r[t]=i[t].bind(r))}}let i=r?.Parent??Object;class s extends i{}function o(e){var t;let i=r?.Parent?new s:this;for(let r of(n(i,e),(t=i._zod).deferred??(t.deferred=[]),i._zod.deferred))r();return i}return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}Object.freeze({status:"aborted"}),Symbol("zod_brand");class P extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let A={};function O(e){return e&&Object.assign(A,e),A}function S(e,t){return"bigint"==typeof t?t.toString():t}function T(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function I(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}let C=Symbol("evaluating");function k(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==C)return void 0===n&&(n=C,n=r()),n},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}"captureStackTrace"in Error||((...e)=>{});function j(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}T(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});let $={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},U={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function q(e,t=0){if(!0===e.aborted)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function D(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function M(e){return"string"==typeof e?e:e?.message}function F(e,t,r){let n={...e,path:e.path??[]};return e.message||(n.message=M(e.inst?._zod.def?.error?.(e))??M(t?.error?.(e))??M(r.customError?.(e))??M(r.localeError?.(e))??"Invalid input"),delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}let H=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,S,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Z=N("$ZodError",H),L=N("$ZodError",H,{Parent:Error}),B=(t=L,r=L,n=L,(e,t,r)=>{let i=r?{...r,async:!1}:{async:!1},s=e._zod.run({value:t,issues:[]},i);if(s instanceof Promise)throw new P;return s.issues.length?{success:!1,error:new(n??Z)(s.issues.map(e=>F(e,i,O())))}:{success:!0,data:s.value}}),K=(i=L,async(e,t,r)=>{let n=r?Object.assign(r,{async:!0}):{async:!0},s=e._zod.run({value:t,issues:[]},n);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new i(s.issues.map(e=>F(e,n,O())))}:{success:!0,data:s.value}}),V=/^-?\d+n?$/,G=/^-?\d+$/,X=/^-?\d+(?:\.\d+)?$/,W=N("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),J=((e,t)=>{W.init(e,t),t.format=t.format||"float64";let r=t.format?.includes("int"),n=r?"int":"number",[i,s]=$[t.format];e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,n.minimum=i,n.maximum=s,r&&(n.pattern=G)}),e._zod.check=o=>{let a=o.value;if(r){if(!Number.isInteger(a))return void o.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});if(!Number.isSafeInteger(a))return void(a>0?o.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}):o.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}))}a<i&&o.issues.push({origin:"number",input:a,code:"too_small",minimum:i,inclusive:!0,inst:e,continue:!t.abort}),a>s&&o.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inclusive:!0,inst:e,continue:!t.abort})}},N("$ZodCheckStringFormat",(e,t)=>{var r,n;W.init(e,t),e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})})),Y={major:4,minor:3,patch:5},Q=N("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Y;let n=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&n.unshift(e),n))for(let r of t._zod.onattach)r(e);if(0===n.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let n,i=q(e);for(let s of t){if(s._zod.def.when){if(!s._zod.def.when(e))continue}else if(i)continue;let t=e.issues.length,o=s._zod.check(e);if(o instanceof Promise&&r?.async===!1)throw new P;if(n||o instanceof Promise)n=(n??Promise.resolve()).then(async()=>{await o,e.issues.length!==t&&(i||(i=q(e,t)))});else{if(e.issues.length===t)continue;i||(i=q(e,t))}}return n?n.then(()=>e):e},r=(r,i,s)=>{if(q(r))return r.aborted=!0,r;let o=t(i,n,s);if(o instanceof Promise){if(!1===s.async)throw new P;return o.then(t=>e._zod.parse(t,s))}return e._zod.parse(o,s)};e._zod.run=(i,s)=>{if(s.skipChecks)return e._zod.parse(i,s);if("backward"===s.direction){let t=e._zod.parse({value:i.value,issues:[]},{...s,skipChecks:!0});return t instanceof Promise?t.then(e=>r(e,i,s)):r(t,i,s)}let o=e._zod.parse(i,s);if(o instanceof Promise){if(!1===s.async)throw new P;return o.then(e=>t(e,n,s))}return t(o,n,s)}}k(e,"~standard",()=>({validate:t=>{try{let r=B(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return K(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}))}),ee=N("$ZodString",(e,t)=>{var r;let n;Q.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??(n=(r=e._zod.bag)?`[\\s\\S]{${r?.minimum??0},${r?.maximum??""}}`:"[\\s\\S]*",RegExp(`^${n}$`)),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch(e){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}});(e,t)=>{J.init(e,t),ee.init(e,t)};(e,t)=>{Q.init(e,t),e._zod.pattern=e._zod.bag.pattern??X,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch(e){}let i=r.value;if("number"==typeof i&&!Number.isNaN(i)&&Number.isFinite(i))return r;let s="number"==typeof i?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:i,inst:e,...s?{received:s}:{}}),r}},(e,t)=>{Q.init(e,t),e._zod.pattern=V,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=BigInt(r.value)}catch(e){}return"bigint"==typeof r.value||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:e}),r}};function et(e,t,r,n,i){if(e.issues.length){if(i&&!(r in n))return;t.issues.push(...D(r,e.issues))}void 0===e.value?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function er(e,t,r,n){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;let i=e.filter(e=>!q(e));return 1===i.length?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>F(e,n,O())))}),t)}(e,t)=>{let r;Q.init(e,t);let n=Object.getOwnPropertyDescriptor(t,"shape");if(!n?.get){let e=t.shape;Object.defineProperty(t,"shape",{get:()=>{let r={...e};return Object.defineProperty(t,"shape",{value:r}),r}})}let i=T(()=>(function(e){var t;let r=Object.keys(e.shape);for(let t of r)if(!e.shape?.[t]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${t}": expected a Zod schema`);let n=Object.keys(t=e.shape).filter(e=>"optional"===t[e]._zod.optin&&"optional"===t[e]._zod.optout);return{...e,keys:r,keySet:new Set(r),numKeys:r.length,optionalKeys:new Set(n)}})(t));k(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let n=e[t]._zod;if(n.values)for(let e of(r[t]??(r[t]=new Set),n.values))r[t].add(e)}return r});let s=t.catchall;e._zod.parse=(t,n)=>{r??(r=i.value);let o=t.value;if(!j(o))return t.issues.push({expected:"object",code:"invalid_type",input:o,inst:e}),t;t.value={};let a=[],u=r.shape;for(let e of r.keys){let r=u[e],i="optional"===r._zod.optout,s=r._zod.run({value:o[e],issues:[]},n);s instanceof Promise?a.push(s.then(r=>et(r,t,e,o,i))):et(s,t,e,o,i)}return s?function(e,t,r,n,i,s){let o=[],a=i.keySet,u=i.catchall._zod,l=u.def.type,d="optional"===u.optout;for(let i in t){if(a.has(i))continue;if("never"===l){o.push(i);continue}let s=u.run({value:t[i],issues:[]},n);s instanceof Promise?e.push(s.then(e=>et(e,r,i,t,d))):et(s,r,i,t,d)}return(o.length&&r.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:s}),e.length)?Promise.all(e).then(()=>r):r}(a,o,t,n,i.value,e):a.length?Promise.all(a).then(()=>t):t}},(e,t)=>{Q.init(e,t),k(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),k(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),k(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),k(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>I(e.source)).join("|")})$`)}});let r=1===t.options.length,n=t.options[0]._zod.run;e._zod.parse=(i,s)=>{if(r)return n(i,s);let o=!1,a=[];for(let e of t.options){let t=e._zod.run({value:i.value,issues:[]},s);if(t instanceof Promise)a.push(t),o=!0;else{if(0===t.issues.length)return t;a.push(t)}}return o?Promise.all(a).then(t=>er(t,i,e,s)):er(a,i,e,s)}};function en(e,t,r){e.issues.length&&t.issues.push(...D(r,e.issues)),t.value[r]=e.value}(e,t)=>{Q.init(e,t);let r=t.items;e._zod.parse=(n,i)=>{let s=n.value;if(!Array.isArray(s))return n.issues.push({input:s,inst:e,expected:"tuple",code:"invalid_type"}),n;n.value=[];let o=[],a=[...r].reverse().findIndex(e=>"optional"!==e._zod.optin),u=-1===a?0:r.length-a;if(!t.rest){let t=s.length>r.length,i=s.length<u-1;if(t||i)return n.issues.push({...t?{code:"too_big",maximum:r.length,inclusive:!0}:{code:"too_small",minimum:r.length},input:s,inst:e,origin:"array"}),n}let l=-1;for(let e of r){if(++l>=s.length&&l>=u)continue;let t=e._zod.run({value:s[l],issues:[]},i);t instanceof Promise?o.push(t.then(e=>en(e,n,l))):en(t,n,l)}if(t.rest)for(let e of s.slice(r.length)){l++;let r=t.rest._zod.run({value:e,issues:[]},i);r instanceof Promise?o.push(r.then(e=>en(e,n,l))):en(r,n,l)}return o.length?Promise.all(o).then(()=>n):n}};function ei(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}(e,t)=>{Q.init(e,t),e._zod.optin="optional",e._zod.optout="optional",k(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),k(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${I(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>{if("optional"===t.innerType._zod.optin){let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(t=>ei(t,e.value)):ei(n,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,r)}};Symbol("ZodOutput"),Symbol("ZodInput");(o=globalThis).__zod_globalRegistry??(o.__zod_globalRegistry=new class e{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let r=t[0];return this._map.set(e,r),r&&"object"==typeof r&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};delete r.id;let n={...r,...this._map.get(e)};return Object.keys(n).length?n:void 0}return this._map.get(e)}has(e){return this._map.has(e)}});let es=globalThis.__zod_globalRegistry,eo=N("ZodError",(e,t)=>{Z.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>(function(e,t=e=>e.message){let r={_errors:[]},n=e=>{for(let i of e.issues)if("invalid_union"===i.code&&i.errors.length)i.errors.map(e=>n({issues:e}));else if("invalid_key"===i.code)n({issues:i.issues});else if("invalid_element"===i.code)n({issues:i.issues});else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){let r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(e),r})(e,t)},flatten:{value:t=>(function(e,t=e=>e.message){let r={},n=[];for(let i of e.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}})(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,S,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,S,2)}},isEmpty:{get:()=>0===e.issues.length}})});class ea extends Error{statusCode;code;constructor(e,t,r){super(t),this.statusCode=e,this.code=r,this.name="ApiError"}}class eu extends ea{constructor(e="Unauthorized"){super(401,e,"UNAUTHORIZED")}}class el extends ea{constructor(e="Forbidden"){super(403,e,"FORBIDDEN")}}class ed extends ea{constructor(e="Not found"){super(404,e,"NOT_FOUND")}}class ec extends ea{retryAfter;constructor(e,t="Too many requests"){super(429,t,"RATE_LIMITED"),this.retryAfter=e}}class ep extends ea{errors;constructor(e,t="Validation failed"){super(400,t,"VALIDATION_ERROR"),this.errors=e}}class ef extends ea{constructor(e="Conflict"){super(409,e,"CONFLICT")}}let eh=(s=async(e,t)=>{let{token:r}=await t.params,n=await (0,E.getUser)();if(!n)throw new eu("You must be logged in to accept invitations");let i=await (0,E.createServerClient)(),{data:s,error:o}=await i.from("idea_collaborators").select(`
      id,
      idea_id,
      user_id,
      email,
      role,
      status,
      invited_by,
      invited_at,
      accepted_at,
      declined_at,
      invite_token,
      expires_at
    `).eq("invite_token",r).single();if(o||!s)throw new ed("Invitation not found or invalid");if("accepted"===s.status)throw new ef("This invitation has already been accepted");if("declined"===s.status)throw new ef("This invitation has been declined");if(new Date(s.expires_at)<new Date)throw new ef("This invitation has expired");let{data:a}=await i.from("profiles").select("email").eq("id",n.id).single();if(!a?.email)throw Error("User profile not found");if(a.email.toLowerCase()!==s.email.toLowerCase())throw new el("This invitation was sent to a different email address. Please sign in with the invited email.");let{data:u,error:l}=await i.from("ideas").select("*").eq("id",s.idea_id).single();if(l||!u)throw new ed("The idea associated with this invitation no longer exists");if(u.user_id===n.id)throw new ef("You cannot accept an invitation to your own idea");let{data:d}=await i.from("idea_collaborators").select("id, status").eq("idea_id",s.idea_id).eq("user_id",n.id).eq("status","accepted").single();if(d)throw new ef("You are already a collaborator on this idea");let{data:c,error:p}=await i.from("idea_collaborators").update({user_id:n.id,status:"accepted",accepted_at:new Date().toISOString(),invite_token:null}).eq("id",s.id).select().single();if(p||!c)throw Error(`Failed to accept invitation: ${p?.message||"Unknown error"}`);let{data:f}=await i.from("profiles").select("id, full_name, avatar_url").eq("id",u.user_id).single(),h={...u,author:f||{id:u.user_id,full_name:null,avatar_url:null}},{data:m}=await i.from("profiles").select("id, full_name, avatar_url").eq("id",s.invited_by).single(),{data:_}=await i.from("profiles").select("id, full_name, avatar_url").eq("id",n.id).single();return function(e,t=200,r){return x.NextResponse.json(e,{status:t,headers:void 0})}({data:{collaborator:{...c,user:_||void 0,inviter:m||void 0},idea:h}})},async(...e)=>{try{return await s(...e)}catch(e){if(e instanceof ec)return x.NextResponse.json({error:e.code,message:e.message,retryAfter:e.retryAfter},{status:e.statusCode,headers:{"Retry-After":String(e.retryAfter)}});if(e instanceof ep)return x.NextResponse.json({error:e.code,message:e.message,errors:e.errors},{status:e.statusCode});if(e instanceof ea)return x.NextResponse.json({error:e.code||"ERROR",message:e.message},{status:e.statusCode});if(e instanceof eo){let t={};for(let r of e.issues){let e=r.path.join(".");t[e]||(t[e]=[]),t[e].push(r.message)}return x.NextResponse.json({error:"VALIDATION_ERROR",message:"Validation failed",errors:t},{status:400})}return console.error("Unhandled API error:",e),x.NextResponse.json({error:"INTERNAL_ERROR",message:"An unexpected error occurred"},{status:500})}});e.s(["POST",0,eh],21149);var em=e.i(21149);let e_=new a.AppRouteRouteModule({definition:{kind:u.RouteKind.APP_ROUTE,page:"/api/invites/[token]/accept/route",pathname:"/api/invites/[token]/accept",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/game/src/app/api/invites/[token]/accept/route.ts",nextConfigOutput:"",userland:em}),{workAsyncStorage:ev,workUnitAsyncStorage:eg,serverHooks:ey}=e_;function eb(){return(0,l.patchFetch)({workAsyncStorage:ev,workUnitAsyncStorage:eg})}async function ew(e,t,r){e_.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/invites/[token]/accept/route";n=n.replace(/\/index$/,"")||"/";let i=await e_.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:s,params:o,nextConfig:a,parsedUrl:l,isDraftMode:E,prerenderManifest:x,routerServerContext:N,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,resolvedPathname:O,clientReferenceManifest:S,serverActionsManifest:T}=i,I=(0,f.normalizeAppPath)(n),C=!!(x.dynamicRoutes[I]||x.routes[O]),k=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,l,!1):t.end("This page could not be found"),null);if(C&&!E){let e=!!x.routes[O],t=x.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(a.experimental.adapterPath)return await k();throw new z.NoFallbackError}}let j=null;!C||e_.isDev||E||(j="/index"===(j=O)?"/":j);let $=!0===e_.isDev||!C,U=C&&!$;T&&S&&(0,p.setManifestsSingleton)({page:n,clientReferenceManifest:S,serverActionsManifest:T});let q=e.method||"GET",D=(0,c.getTracer)(),M=D.getActiveScopeSpan(),F={params:o,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!a.experimental.authInterrupts},cacheComponents:!!a.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,d.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:a.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,i)=>e_.onRequestError(e,t,n,i,N)},sharedContext:{buildId:s}},H=new h.NodeNextRequest(e),Z=new h.NodeNextResponse(t),L=m.NextRequestAdapter.fromNodeNextRequest(H,(0,m.signalFromNodeResponse)(t));try{let i=async e=>e_.handle(L,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=D.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==_.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${q} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${n}`)}),s=!!(0,d.getRequestMeta)(e,"minimalMode"),o=async o=>{var l,d;let c=async({previousCacheEntry:a})=>{try{if(!s&&P&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let u=F.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let l=F.renderOpts.collectedTags;if(!C)return await (0,g.sendResponse)(H,Z,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[w.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,i=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==a?void 0:a.isStale)&&await e_.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,v.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},!1,N),t}},p=await e_.handleResponse({req:e,nextConfig:a,cacheKey:j,routeKind:u.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:s});if(!C)return null;if((null==p||null==(l=p.value)?void 0:l.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(d=p.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",P?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,y.fromNodeOutgoingHttpHeaders)(p.value.headers);return s&&C||f.delete(w.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,b.getCacheControlHeader)(p.cacheControl)),await (0,g.sendResponse)(H,Z,new Response(p.value.body,{headers:f,status:p.value.status||200})),null};M?await o(M):await D.withPropagatedContext(e.headers,()=>D.trace(_.BaseServerSpan.handleRequest,{spanName:`${q} ${n}`,kind:c.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},o))}catch(t){if(t instanceof z.NoFallbackError||await e_.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,v.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},!1,N),C)throw t;return await (0,g.sendResponse)(H,Z,new Response(null,{status:500})),null}}e.s(["handler",()=>ew,"patchFetch",()=>eb,"routeModule",()=>e_,"serverHooks",()=>ey,"workAsyncStorage",()=>ev,"workUnitAsyncStorage",()=>eg],3444)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_93b6c97f.js.map